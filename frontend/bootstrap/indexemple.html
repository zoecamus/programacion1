<!doctype html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>La Roti · Empleado</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <script defer src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet" />

    <style>
      :root{
        --brand:#ff914d; --brand-dark:#826346; --brand-light:#faf4e6;
        --ink:#182230; --muted:#6b7280; --chip:#fff4ec;
        --radius-lg:1rem; --shadow-sm:0 2px 10px rgba(0,0,0,.06);
      }
      body{font-family:system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;color:var(--ink);background:#f8f9fa;}
      .navbar-roti{background:#fff!important;box-shadow:var(--shadow-sm);}
      .navbar-roti .navbar-brand{font-weight:700}
      #logoRoti{height:46px}
      .hero{background:linear-gradient(180deg,var(--brand) 0%, #ff8533 70%, #fff 100%);color:#fff;}
      .btn-brand{background:var(--brand);color:#fff;border:none}
      .btn-brand:hover{background:var(--brand-dark);color:#fff}
      .btn-ink{background:var(--brand-dark);color:#fff;border:none}
      .btn-ink:hover{filter:brightness(.95)}
      .nav-pills .nav-link.active{background:var(--brand-dark);}
      .card{border:0;border-radius:var(--radius-lg);box-shadow:var(--shadow-sm);}
      .card .card-header{background:#fff;border-bottom:1px solid rgba(0,0,0,.06);border-top-left-radius:var(--radius-lg);border-top-right-radius:var(--radius-lg);}
      .table thead th{white-space:nowrap}
      .table> :not(caption)>*>*{vertical-align:middle}
      .thumb-40{width:40px;height:40px;object-fit:cover;border-radius:.5rem}
      .thumb-44{width:44px;height:44px;object-fit:cover;border-radius:.5rem}
      .chip{display:inline-flex;align-items:center;gap:.5rem;background:var(--chip);padding:.6rem 1rem;border-radius:999px;font-weight:700;border:1px solid rgba(0,0,0,.06)}
      .chip.active{outline:2px solid var(--brand)}
    </style> <style>
      :root{
        --brand:#ff914d; --brand-dark:#826346; --brand-light:#faf4e6;
        --ink:#182230; --muted:#6b7280; --chip:#fff4ec;
        --radius-lg:1rem; --shadow-sm:0 2px 10px rgba(0,0,0,.06);
      }
      body{font-family:system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;color:var(--ink);background:#f8f9fa;}
      .navbar-roti{background:#fff!important;box-shadow:var(--shadow-sm);}
      .navbar-roti .navbar-brand{font-weight:700}
      #logoRoti{height:46px}
      .hero{background:linear-gradient(180deg,var(--brand) 0%, #ff8533 70%, #fff 100%);color:#fff;}
      .btn-brand{background:var(--brand);color:#fff;border:none}
      .btn-brand:hover{background:var(--brand-dark);color:#fff}
      .btn-ink{background:var(--brand-dark);color:#fff;border:none}
      .btn-ink:hover{filter:brightness(.95)}
      .nav-pills .nav-link.active{background:var(--brand-dark);}
      .card{border:0;border-radius:var(--radius-lg);box-shadow:var(--shadow-sm);}
      .card .card-header{background:#fff;border-bottom:1px solid rgba(0,0,0,.06);border-top-left-radius:var(--radius-lg);border-top-right-radius:var(--radius-lg);}
      .table thead th{white-space:nowrap}
      .table> :not(caption)>*>*{vertical-align:middle}
      .thumb-40{width:40px;height:40px;object-fit:cover;border-radius:.5rem}
      .thumb-44{width:44px;height:44px;object-fit:cover;border-radius:.5rem}
      .chip{display:inline-flex;align-items:center;gap:.5rem;background:var(--chip);padding:.6rem 1rem;border-radius:999px;font-weight:700;border:1px solid rgba(0,0,0,.06)}
      .chip.active{outline:2px solid var(--brand)}
    </style>
  </head>

  <body>
    <nav class="navbar navbar-expand-lg navbar-light navbar-roti sticky-top">
      <div class="container d-flex align-items-center justify-content-between">
        <a class="navbar-brand" href="#"><i class="bi bi-egg-fried me-2"></i>La Roti · Empleado</a>
        <div class="d-flex align-items-center gap-3">
          <img src="logo/roti.png" id="logoRoti" alt="La Roti" />
          <button class="btn btn-ink btn-sm"><i class="bi bi-box-arrow-right me-1"></i>Cerrar sesión</button>
        </div>
      </div>
    </nav>

    <header class="hero py-4">
      <div class="container d-flex flex-wrap align-items-center justify-content-between gap-3">
        <div>
          <h1 class="h4 fw-bold mb-1">Panel del empleado</h1>
        </div>
        <div class="d-flex gap-2">
          <button class="btn btn-ink" id="btnRefresh"><i class="bi bi-arrow-repeat me-1"></i>Actualizar</button>
        </div>
      </div>
    </header>

    <main class="container my-4">
      <ul class="nav nav-pills mb-3" role="tablist">
        <li class="nav-item" role="presentation">
          <button class="nav-link active" data-bs-toggle="pill" data-bs-target="#pane-pedidos" type="button" role="tab">Pedidos</button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link" data-bs-toggle="pill" data-bs-target="#pane-historial" type="button" role="tab">Historial</button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link" data-bs-toggle="pill" data-bs-target="#pane-caja" type="button" role="tab">Caja</button>
        </li>
      </ul>

      <div class="tab-content">
        <section class="tab-pane fade show active" id="pane-pedidos" role="tabpanel">
          <div class="d-flex flex-wrap gap-2 mb-3">
            <button class="btn btn-brand" data-bs-toggle="modal" data-bs-target="#nuevoPedido">
              <i class="bi bi-plus-circle me-1"></i>Nuevo pedido
            </button>
            <div class="input-group" style="width:260px">
              <span class="input-group-text"><i class="bi bi-search"></i></span>
              <input id="orderSearch" class="form-control" placeholder="Buscar # o cliente…" />
            </div>
          </div>

          <div class="row g-3">
            <div class="col-lg-6">
              <div class="card h-100">
                <div class="card-header d-flex justify-content-between align-items-center">
                  <span class="fw-semibold"><i class="bi bi-truck me-1"></i>Pedidos en curso</span>
                  <span class="small text-body-secondary">Click para ver detalle</span>
                </div>
                <div class="list-group list-group-flush" id="ordersList"></div>
              </div>
            </div>

            <div class="col-lg-6">
              <div class="card h-100">
                <div class="card-header d-flex justify-content-between align-items-center">
                  <span class="fw-semibold"><i class="bi bi-clipboard-check me-1"></i>Detalle</span>
                  <div class="small text-body-secondary">Actualizar estado, cobrar, ticket</div>
                </div>
                <div class="card-body" id="orderDetail">
                  <div class="text-body-secondary">Seleccioná un pedido para ver el detalle.</div>
                </div>
              </div>
            </div>
          </div>
        </section>

        <section class="tab-pane fade" id="pane-caja" role="tabpanel">
          <div class="row g-3">
            <div class="col-lg-7">
              <div class="card h-100">
                <div class="card-header"><span class="fw-semibold"><i class="bi bi-cash-coin me-1"></i>Cobros del día</span></div>
                <div class="table-responsive">
                  <table class="table align-middle mb-0">
                    <thead class="table-light"><tr><th>#</th><th>Cliente</th><th>Método</th><th class="text-end">Monto</th></tr></thead>
                    <tbody id="cajaBody"></tbody>
                  </table>
                </div>
              </div>
            </div>
            <div class="col-lg-5">
              <div class="card h-100">
                <div class="card-header"><span class="fw-semibold"><i class="bi bi-clipboard-data me-1"></i>Resumen</span></div>
                <div class="card-body">
                  <div class="d-flex justify-content-between"><span>Pedidos cobrados</span><strong id="cajaCount">0</strong></div>
                  <div class="d-flex justify-content-between"><span>Total efectivo</span><strong id="cajaEfvo">$0</strong></div>
                  <div class="d-flex justify-content-between"><span>Total transferencia</span><strong id="cajaTransf">$0</strong></div>
                  <div class="d-flex justify-content-between"><span>Total mercado pago</span><strong id="cajaMP">$0</strong></div>
                </div>
              </div>
            </div>
          </div>
        </section>

        <section class="tab-pane fade" id="pane-historial" role="tabpanel">
          <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
              <span class="fw-semibold"><i class="bi bi-clock-history me-1"></i>Historial reciente</span>
              <div class="input-group input-group-sm" style="width:260px">
                <span class="input-group-text"><i class="bi bi-search"></i></span>
                <input id="histSearch" class="form-control" placeholder="Buscar # o cliente…" />
              </div>
            </div>
            <div class="table-responsive">
              <table class="table align-middle mb-0">
                <thead class="table-light"><tr><th>#</th><th>Cliente</th><th>Items</th><th>Estado</th><th class="text-end">Fecha</th></tr></thead>
                <tbody id="histBody"></tbody>
              </table>
            </div>
          </div>
        </section>
      </div>
    </main>

    <footer class="border-top py-4 bg-white mt-4">
      <div class="container d-flex flex-wrap justify-content-between align-items-center gap-3">
        <div class="text-body-secondary">© <span id="year"></span> La Roti</div>
        <div class="d-flex gap-3">
        </div>
      </div>
    </footer>

    <div class="offcanvas offcanvas-end" tabindex="-1" id="help">
      <div class="offcanvas-header">
        <h5 class="offcanvas-title">Ayuda</h5>
        <button class="btn-close" data-bs-dismiss="offcanvas"></button>
      </div>
      <div class="offcanvas-body small">
        <p>Vista <b>Empleado</b> (coherente con Usuario y Admin).</p>
        <ul>
          <li><b>Pedidos</b>: ver, avanzar estado, marcar pago, ticket, cancelar.</li>
          <li><b>Nuevo pedido</b>: buscá productos, armá carrito y confirmá.</li>
          <li><b>Caja</b>: resumen de cobros por método.</li>
        </ul>
      </div>
    </div>

    <div class="modal fade" id="nuevoPedido" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Nuevo pedido</h5>
            <button class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body">
            <div class="row g-3">
              <div class="col-md-6">
                <div class="input-group input-group-sm mb-2">
                  <span class="input-group-text"><i class="bi bi-search"></i></span>
                  <input id="npSearch" class="form-control" placeholder="Buscar producto…" />
                </div>
                <div class="list-group small" id="npProducts" style="max-height:280px;overflow:auto"></div>
              </div>
              <div class="col-md-6">
                <div class="d-flex justify-content-between align-items-center mb-2">
                  <div class="fw-semibold">Carrito</div>
                  <select id="npMetodo" class="form-select form-select-sm" style="width:180px">
                    <option value="efectivo">Efectivo</option>
                    <option value="transferencia">Transferencia</option>
                    <option value="mp">Mercado Pago</option>
                  </select>
                </div>
                <div class="table-responsive">
                  <table class="table table-sm align-middle mb-2">
                    <thead class="table-light"><tr><th>Producto</th><th class="text-center">Cant.</th><th class="text-end">Subtotal</th><th></th></tr></thead>
                    <tbody id="npBody"></tbody>
                    <tfoot><tr><th>Total</th><th></th><th class="text-end" id="npTotal">$0</th><th></th></tr></tfoot>
                  </table>
                </div>
                <div class="mb-2">
                  <input id="npCliente" class="form-control form-control-sm" placeholder="Nombre del cliente (opcional)" />
                </div>
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancelar</button>
            <button class="btn btn-brand" id="npConfirm">Crear pedido</button>
          </div>
        </div>
      </div>
    </div>

    <script>
      const PRODUCTS = {
        1: { id:1, name:'Patitas de pollo x12', img:'logo/RotiPatitas.png',        price:8500 },
        2: { id:2, name:'Hamburguesa',           img:'logo/rotiBurger.png',         price:10000 },
        3: { id:3, name:'Papas Fritas',          img:'logo/RotiPapitasFritas.png',  price:5000 },
        4: { id:4, name:'Ensalada',              img:'logo/RotiEnsalada.png',       price:2200 },
        5: { id:5, name:'Chocotorta',            img:'logo/Rotichoco.png',          price:2700 },
        6: { id:6, name:'Cheesecake',            img:'logo/Roticheese.png',         price:2800 }
      };

      const ORDERS = [
        { id:901, client:'María Modarelli',   items:[{pid:2,q:1},{pid:3,q:1}], status:'Recibido',           date:'04/09 15:35', paid:false, method:null,          notes:'Sin pepino' },
        { id:902, client:'Guadalupe Yañez',   items:[{pid:1,q:1},{pid:4,q:1}], status:'En preparación',     date:'04/09 15:20', paid:true,  method:'efectivo'                         },
        { id:903, client:'Eugenia Morales',   items:[{pid:2,q:2}],             status:'Listo para retirar', date:'04/09 15:05', paid:false, method:null                            }
      ];

      const HISTORY = [
        { id:880, client:'Alberto Borges',  items:2, status:'Entregado', date:'03/09 21:14' },
        { id:881, client:'Eugenia Morales', items:1, status:'Entregado', date:'03/09 20:47' },
        { id:882, client:'María Sol Pérez', items:4, status:'Entregado', date:'03/09 19:33' }
      ];

      const CAJA = [];

      const $ = (s) => document.querySelector(s);
      const money = (n) => n.toLocaleString('es-AR');
      const badgeBy = (s) => ({ 'Recibido':'secondary','En preparación':'warning','Listo para retirar':'info','Entregado':'success' }[s] || 'light');

      function renderOrders() {
        const q = ($('#orderSearch').value || '').toLowerCase();
        const list = $('#ordersList');
        list.innerHTML = '';
        ORDERS
          .filter(o => (`${o.id} ${o.client}`).toLowerCase().includes(q))
          .forEach(o => {
            list.insertAdjacentHTML(
              'beforeend',
              `<button class="list-group-item list-group-item-action d-flex justify-content-between align-items-center" data-oid="${o.id}">
                <div>
                  <div class="fw-semibold">Pedido #${o.id}</div>
                  <div class="small text-body-secondary">${o.client || '—'} · ${o.items.reduce((a,b)=>a+b.q,0)} ítems</div>
                </div>
                <span class="badge rounded-pill text-bg-${badgeBy(o.status)}">${o.status}</span>
              </button>`
            );
          });
      }

      function renderDetail(id) {
        const o = ORDERS.find(x => x.id === id);
        if (!o) {
          $('#orderDetail').innerHTML = '<div class="text-body-secondary">Seleccioná un pedido.</div>';
          return;
        }
        const rows = o.items.map(it => {
          const p = PRODUCTS[it.pid];
          return `<tr>
            <td>
              <div class="d-flex align-items-center gap-2">
                <img src="${p.img}" width="40" height="40" class="thumb-40" alt="">
                <div>${p.name}</div>
              </div>
            </td>
            <td class="text-center">x${it.q}</td>
            <td class="text-end">$${money(p.price * it.q)}</td>
          </tr>`;
        }).join('');
        const flow = ['Recibido','En preparación','Listo para retirar','Entregado'];
        const cur  = o.status;
        const ni   = Math.min(flow.indexOf(cur) + 1, flow.length - 1);
        const nextLabel = flow[ni];
        const total = o.items.reduce((a,b) => a + PRODUCTS[b.pid].price * b.q, 0);

        $('#orderDetail').innerHTML = `
          <div class="d-flex justify-content-between align-items-start mb-2">
            <div>
              <div class="fw-semibold">Pedido #${o.id}</div>
              <div class="small text-body-secondary">${o.client || '—'} · ${o.date}</div>
            </div>
            <div class="d-flex align-items-center gap-2">
              <span class="badge text-bg-${badgeBy(o.status)}">${o.status}</span>
              ${o.paid ? '<span class="badge text-bg-success">Pagado</span>' : '<span class="badge text-bg-secondary">No pago</span>'}
            </div>
          </div>
          <div class="table-responsive mb-2">
            <table class="table table-sm align-middle mb-0">
              <thead class="table-light"><tr><th>Producto</th><th class="text-center">Cant.</th><th class="text-end">Subtotal</th></tr></thead>
              <tbody>${rows}</tbody>
              <tfoot><tr><th>Total</th><th></th><th class="text-end">$${money(total)}</th></tr></tfoot>
            </table>
          </div>
          <div class="d-flex flex-wrap gap-2">
            <button class="btn btn-brand" data-advance="${o.id}"><i class="bi bi-check2-circle me-1"></i>Pasar a: ${nextLabel}</button>
            <button class="btn btn-outline-success" data-pay="${o.id}"><i class="bi bi-cash-coin me-1"></i>Marcar pagado</button>
            <button class="btn btn-outline-secondary" data-ticket="${o.id}"><i class="bi bi-printer me-1"></i>Ticket</button>
            ${o.status !== 'Entregado' ? `<button class="btn btn-outline-danger" data-cancel="${o.id}"><i class="bi bi-x-circle me-1"></i>Cancelar</button>` : ''}
          </div>
        `;
      }

      function renderHist() {
        const q = ($('#histSearch').value || '').toLowerCase();
        const rows = HISTORY
          .filter(h => (`${h.id} ${h.client} ${h.status}`).toLowerCase().includes(q))
          .map(h => `<tr><td>#${h.id}</td><td>${h.client}</td><td>${h.items}</td><td><span class="badge text-bg-success">${h.status}</span></td><td class="text-end">${h.date}</td></tr>`)
          .join('');
        document.getElementById('histBody').innerHTML = rows || '<tr><td colspan="5" class="text-center text-body-secondary py-4">Sin resultados</td></tr>';
      }

      function addCaja({ id, client, method, amount }) {
        if (CAJA.find(r => r.id === id)) return;
        CAJA.push({ id, client, method, amount });
        renderCaja();
      }
      function sumBy(m) { return CAJA.filter(r => r.method === m).reduce((a,b)=>a+b.amount,0); }
      function renderCaja() {
        const tbody = document.getElementById('cajaBody');
        const rows = CAJA
          .map(r => `<tr><td>#${r.id}</td><td>${r.client}</td><td class="text-capitalize">${r.method}</td><td class="text-end">$${money(r.amount)}</td></tr>`)
          .join('');
        tbody.innerHTML = rows || '<tr><td colspan="4" class="text-center text-body-secondary py-4">Sin cobros</td></tr>';
        document.getElementById('cajaCount').textContent  = CAJA.length;
        document.getElementById('cajaEfvo').textContent   = '$' + money(sumBy('efectivo'));
        document.getElementById('cajaTransf').textContent = '$' + money(sumBy('transferencia'));
        document.getElementById('cajaMP').textContent     = '$' + money(sumBy('mp'));
      }

      document.addEventListener('click', (ev) => {
        const row = ev.target.closest('[data-oid]');
        if (row) { renderDetail(parseInt(row.dataset.oid, 10)); return; }

        const adv = ev.target.closest('[data-advance]');
        if (adv) {
          const id  = parseInt(adv.dataset.advance, 10);
          const idx = ORDERS.findIndex(x => x.id === id);
          if (idx < 0) return;
          const flow = ['Recibido','En preparación','Listo para retirar','Entregado'];
          const cur  = ORDERS[idx].status;
          const ni   = Math.min(flow.indexOf(cur) + 1, flow.length - 1);
          ORDERS[idx].status = flow[ni];

          if (ORDERS[idx].status === 'Entregado') {
            if (ORDERS[idx].paid) {
              const total = ORDERS[idx].items.reduce((a, b) => a + PRODUCTS[b.pid].price * b.q, 0);
              addCaja({ id: ORDERS[idx].id, client: ORDERS[idx].client || '—', method: ORDERS[idx].method || 'efectivo', amount: total });
            }
            const totalItems = ORDERS[idx].items.reduce((a, b) => a + b.q, 0);
            HISTORY.unshift({
              id: ORDERS[idx].id,
              client: ORDERS[idx].client || '—',
              items: totalItems,
              status: 'Entregado',
              date: new Date().toLocaleString('es-AR', { hour: '2-digit', minute: '2-digit', day: '2-digit', month: '2-digit' })
            });
            ORDERS.splice(idx, 1);
            document.getElementById('orderDetail').innerHTML = '<div class="alert alert-success">Pedido entregado.</div>';
          }
          renderOrders();
        }

        const pay = ev.target.closest('[data-pay]');
        if (pay) {
          const id  = parseInt(pay.dataset.pay, 10);
          const idx = ORDERS.findIndex(x => x.id === id);
          if (idx < 0) return;
          const method = (prompt('Método de pago: efectivo / transferencia / mp', 'efectivo') || 'efectivo').toLowerCase();
          ORDERS[idx].paid   = true;
          ORDERS[idx].method = method;
          const total = ORDERS[idx].items.reduce((a, b) => a + PRODUCTS[b.pid].price * b.q, 0);
          addCaja({ id: ORDERS[idx].id, client: ORDERS[idx].client || '—', method: ORDERS[idx].method, amount: total });
          renderDetail(id);
        }

        const ticket = ev.target.closest('[data-ticket]');
        if (ticket) { alert('Ticket impreso (simulado).'); }

        const cancel = ev.target.closest('[data-cancel]');
        if (cancel) {
          const id  = parseInt(cancel.dataset.cancel, 10);
          const idx = ORDERS.findIndex(x => x.id === id);
          if (idx >= 0) {
            ORDERS.splice(idx, 1);
            renderOrders();
            document.getElementById('orderDetail').innerHTML = '<div class="alert alert-secondary">Pedido cancelado.</div>';
          }
        }
      });

      const NP_CART = [];
      function npRenderProducts() {
        const q = (document.getElementById('npSearch').value || '').toLowerCase();
        const list = document.getElementById('npProducts');
        list.innerHTML = '';
        Object.values(PRODUCTS)
          .filter(p => p.name.toLowerCase().includes(q))
          .forEach(p => {
            list.insertAdjacentHTML(
              'beforeend',
              `<button class="list-group-item list-group-item-action d-flex align-items-center gap-2" data-npadd="${p.id}">
                <img src="${p.img}" class="thumb-40" alt="">
                <div class="flex-grow-1">${p.name}</div>
                <span class="fw-semibold ms-auto">$${money(p.price)}</span>
              </button>`
            );
          });
      }
      function npRenderCart() {
        const body = document.getElementById('npBody');
        const total = NP_CART.reduce((a, it) => a + PRODUCTS[it.pid].price * it.q, 0);
        body.innerHTML = NP_CART.map(it => {
          const p = PRODUCTS[it.pid];
          return `<tr>
            <td>${p.name}</td>
            <td class="text-center">x${it.q}</td>
            <td class="text-end">$${money(p.price * it.q)}</td>
            <td class="text-end"><button class="btn btn-sm btn-outline-danger" data-npdel="${it.pid}"><i class="bi bi-trash"></i></button></td>
          </tr>`;
        }).join('') || '<tr><td colspan="4" class="text-body-secondary text-center">Vacío</td></tr>';
        document.getElementById('npTotal').textContent = '$' + money(total);
      }

      document.addEventListener('click', (ev) => {
        const add = ev.target.closest('[data-npadd]');
        if (add) {
          const pid = parseInt(add.dataset.npadd, 10);
          const i = NP_CART.findIndex(x => x.pid === pid);
          if (i >= 0) NP_CART[i].q++;
          else NP_CART.push({ pid, q: 1 });
          npRenderCart();
        }
        const del = ev.target.closest('[data-npdel]');
        if (del) {
          const pid = parseInt(del.dataset.npdel, 10);
          const i = NP_CART.findIndex(x => x.pid === pid);
          if (i >= 0) NP_CART.splice(i, 1);
          npRenderCart();
        }
      });

      document.getElementById('npSearch').addEventListener('input', npRenderProducts);
      document.getElementById('npConfirm').addEventListener('click', () => {
        if (!NP_CART.length) { alert('Agregá al menos un producto.'); return; }
        const id     = Math.max(900, ...ORDERS.map(o => o.id)) + 1;
        const items  = NP_CART.map(x => ({ pid: x.pid, q: x.q }));
        const method = document.getElementById('npMetodo').value;
        const client = document.getElementById('npCliente').value;
        ORDERS.unshift({
          id,
          client: client || '—',
          items,
          status: 'Recibido',
          date: new Date().toLocaleString('es-AR', { hour: '2-digit', minute: '2-digit', day: '2-digit', month: '2-digit' }),
          paid: false,
          method: null
        });
        NP_CART.length = 0;
        npRenderCart();
        renderOrders();
        const m = bootstrap.Modal.getInstance(document.getElementById('nuevoPedido'));
        if (m) m.hide();
      });

      document.getElementById('orderSearch').addEventListener('input', renderOrders);
      document.getElementById('histSearch').addEventListener('input', renderHist);
      document.getElementById('btnRefresh').addEventListener('click', () => { renderOrders(); renderHist(); renderCaja(); });

      renderOrders(); renderHist(); renderCaja(); npRenderProducts(); npRenderCart();
      document.getElementById('year').textContent = new Date().getFullYear();
    </script>
  </body>
</html>

